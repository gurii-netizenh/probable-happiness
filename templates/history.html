{% extends "base.html" %} {% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="card shadow-lg">
      <div class="card-header d-flex justify-content-between">
        <h5><i class="fas fa-chart-line"></i> Happiness Trends</h5>
        <a href="{{ url_for('export') }}" class="btn btn-outline-primary btn-sm"
          ><i class="fas fa-download"></i> Export CSV</a
        >
      </div>
      <div class="card-body">
        <canvas id="scoreChart"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card shadow-lg">
      <div class="card-header">
        <h6><i class="fas fa-info-circle"></i> Stats</h6>
      </div>
      <div class="card-body">
        <p><strong>Average Score:</strong> {{ avg }}/100</p>
        <p><strong>Entries:</strong> {{ logs|length }}</p>
        {% if logs %}
        <p>
          <strong>Best Day:</strong> {{ logs|max(attribute='score').score }}
        </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<script>
  const ctx = document.getElementById('scoreChart').getContext('2d');
  const labels = {{ logs | map(attribute='date') | list | tojson }};
  const data = {{ logs | map(attribute='score') | list | tojson }};
  new Chart(ctx, {
      type: 'line',
      data: {
          labels: labels,
          datasets: [{
              label: 'Score',
              data: data,
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: { beginAtZero: true, max: 100 }
          }
      }
  });
</script>
{% endblock %}
